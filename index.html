<!DOCTYPE html>
<html lang="es">
<link rel="icon" type="image/png" href="Logotipo_UIS.png">
0<head>
    <meta charset="UTF-8">
    <title>Asistente Conversacional UIS - Historia y Servicios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Paleta: Verde UIS (Acento Principal) y AZUL MARINO OSCURO (Fondo) */
        :root {
            --color-uis-green: #34a853; /* Verde UIS - Acento fuerte */
            --color-uis-green-hover: #2d8f47;
            --color-uis-light: #e6f7e9; /* Verde muy claro para burbuja del bot */
            
            /* --- COLORES DE FONDO OSCURO (RGB 0, 11, 26) --- */
            --color-dark-bg: rgb(0, 11, 26);
            --color-bg: var(--color-dark-bg); /* Fondo de la p√°gina */
            --color-card-bg: var(--color-dark-bg); /* Fondo del chat/login */
            
            /* --- COLORES DE TEXTO Y CONTRASTE --- */
            --color-text: #f0f0f0; /* Texto principal CLARO */
            --color-text-secondary: #aaaaaa; /* Texto secundario gris claro */
            --color-border: #333333; /* Borde oscuro visible */
        }

        /* Estilos Base */
        body {
            font-family: 'Google Sans', 'Roboto', Arial, sans-serif;
            background-color: var(--color-bg);
            margin: 0;
            color: var(--color-text);
        }

        /* ************************************** */
        /* CONTENEDOR CENTRAL/PRINCIPAL */
        /* ************************************** */
        #contenedorCentrador {
            display: flex; 
            flex-direction: column;
            justify-content: flex-start;
            align-items: center; 
            min-height: 100vh; 
            width: 100%;
        }

        .contenedor-principal {
            background-color: var(--color-card-bg); 
            max-width: 100%; 
            width: 100%;
            height: 100vh; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        #cuestionario {
            padding: 40px; 
            border-radius: 18px;
            max-width: 400px; 
            height: auto;
            text-align: center;
            background-color: #1a2a3a; /* Un tono ligeramente menos oscuro para el login */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            margin: auto; 
        }
        
        /* ************************************** */
        /* LOGO y HEADER (Con Men√∫ de Acciones) */
        /* ************************************** */
        /* Logo grande para la pantalla de inicio */
        #logo-uis-login {
            height: 120px; 
            width: auto;
            margin-bottom: 12px;
        }

        /* Logo peque√±o para el encabezado del chat */
        #logo-uis-header {
            height: 40px; /* Tama√±o del logo en el encabezado */
            width: auto;
            margin-right: 12px; /* Espacio entre el logo y el texto */
        }
        
        #contenedorMenu h2 {
            background-color: var(--color-uis-green); 
            color: white;
            padding: 15px; 
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.4em; 
            position: relative; 
        }

        /* Men√∫ de Acciones Superior */
        #menuAccionesWrapperSuperior {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            display: flex;
            align-items: center;
            padding-right: 15px;
        }

        #btnMenuAcciones {
            background-color: transparent; 
            color: white; 
            border: none;
            padding: 5px 10px; 
            border-radius: 50%; 
            font-size: 1.5em; 
            cursor: pointer;
            line-height: 1; 
            transition: color 0.2s;
            margin-right: 0; 
        }
        #btnMenuAcciones:hover {
            color: #d1e5d6; 
        }

        /* Controles Superiores (Men√∫ desplegable) */
        #controlesSuperiores {
            display: none; 
            position: absolute;
            top: 55px; 
            right: 5px; 
            
            background-color: #2c3a4a; /* Fondo oscuro para el men√∫ desplegable */
            border: 1px solid var(--color-border);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            z-index: 10;
            min-width: 150px;
            flex-direction: column;
            padding: 5px 0;
        }
        #controlesSuperiores.active {
            display: flex;
        }
        
        #controlesSuperiores .btn-accion-secundaria {
            width: 100%;
            padding: 10px 15px;
            border: none;
            text-align: left;
            border-radius: 0;
            background-color: transparent;
            font-size: 0.9em;
            color: var(--color-text); /* Texto claro */
            cursor: pointer;
        }
        #controlesSuperiores .btn-accion-secundaria:hover {
            background-color: #3f5166; /* Fondo de hover oscuro */
        }
        #controlesSuperiores .btn-accion-secundaria.cerrar-sesion {
            color: #ff6666; /* Rojo claro para cerrar sesi√≥n */
        }
        
        /* Input de Texto y Bot√≥n Primario */
        .input-registro {
            width: 90%; 
            padding: 10px; 
            border: 1px solid var(--color-border);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 0.95em;
            background-color: #1a2a3a; /* Fondo oscuro del input */
            color: var(--color-text); /* Texto claro */
            margin-bottom: 10px;
        }
        
        /* Estilos espec√≠ficos para el Checkbox de Autorizaci√≥n */
        #contenedorAutorizacion {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 90%;
            margin: 15px auto 15px auto;
            text-align: left;
        }

        #checkAutorizacion {
            margin-right: 10px;
            /* Estilo para que el checkbox sea visible en fondo oscuro */
            border: 1px solid var(--color-uis-green); 
            background-color: #2c3a4a;
            appearance: none; /* Ocultar el estilo predeterminado */
            width: 18px;
            height: 18px;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        
        #checkAutorizacion:checked {
            background-color: var(--color-uis-green);
            border-color: var(--color-uis-green);
        }
        
        /* Simular la marca de verificaci√≥n */
        #checkAutorizacion:checked::before {
            content: '‚úì';
            color: white;
            font-size: 14px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #contenedorAutorizacion label {
            font-size: 0.85em;
            color: var(--color-text-secondary);
            cursor: pointer;
        }


        button.primary-btn {
            background-color: var(--color-uis-green); 
            color: white; 
            padding: 12px 25px; 
            border: none;
            border-radius: 8px; 
            font-size: 1em; 
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        button.primary-btn:hover {
            background-color: var(--color-uis-green-hover);
        }
        
        /* ************************************** */
        /* CHAT LOG y Burbujas */
        /* ************************************** */
        #historialChat {
            flex-grow: 1;
            padding: 20px 3%; 
            overflow-y: auto;
            background-color: var(--color-card-bg); /* Fondo oscuro del chat */
            margin: 0;
        }
        
        .chat-bot {
            background-color: #1a2a3a; /* Un color de burbuja oscuro pero diferente */
            color: var(--color-text);
            padding: 15px 20px; 
            border-radius: 18px; 
            max-width: 80%; 
            margin-bottom: 10px; 
            float: left;
            clear: both;
            border: 1px solid #3f5166; /* Borde m√°s sutil */
            font-size: 1em; 
            line-height: 1.5;
        }
        .chat-bot h4 {
            color: var(--color-uis-green); 
            margin-top: 0;
            margin-bottom: 8px;
            font-size: 1.2em; 
        }
        .chat-user {
            background-color: #3f5166; /* Burbuja de usuario m√°s oscura */
            color: var(--color-text);
            padding: 10px 15px; 
            border-radius: 18px; 
            max-width: 80%; 
            margin-bottom: 10px;
            float: right; 
            clear: both;
            font-size: 0.9em; 
        }
        .acciones-post-respuesta {
             padding-right: 0 !important; 
        }

        /* ************************************** */
        /* FOOTER OPTIMIZADO (Comandos R√°pidos + Input) */
        /* ************************************** */
        #opcionesFooter {
            padding: 10px 3%; 
            border-top: 1px solid var(--color-border);
            background-color: #1a2a3a; /* Fondo oscuro del footer */
            display: flex;
            flex-direction: column;
            gap: 8px; 
        }

        #opcionesMenu {
            display: flex;
            flex-wrap: wrap;
            gap: 6px; 
            padding: 0;
            margin-bottom: 5px;
            justify-content: flex-start; 
            max-width: 100%;
        }
        
        .opcion-btn {
            background-color: #3f5166; /* Botones de opci√≥n oscuros */
            color: var(--color-text); /* Texto claro en los botones */
            border: none; 
            padding: 6px 12px; 
            border-radius: 20px; 
            cursor: pointer;
            font-size: 0.85em; 
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: 0 1px 2px rgba(0,0,0,0.4); 
        }
        .opcion-btn:hover {
            background-color: #556b82; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.5); 
            transform: translateY(-1px); 
        }
        
        /* Contenedor de Entrada de Texto */
        #inputChatContainer {
            display: flex;
            gap: 8px; 
            align-items: flex-end; 
        }

        #inputMensaje {
            flex-grow: 1;
            padding: 10px 18px; 
            border: 1px solid var(--color-border);
            border-radius: 25px; 
            font-size: 1em; 
            background-color: #2c3a4a; /* Fondo oscuro del input principal */
            color: var(--color-text);
        }

        /* Bot√≥n de Enviar (√çcono Verde) */
        #btnEnviar {
            background-color: var(--color-uis-green);
            color: white; 
            border: none;
            border-radius: 50%; 
            width: 40px; 
            height: 40px; 
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        #btnEnviar:hover {
            background-color: var(--color-uis-green-hover);
        }

        /* Estilos de la rese√±a */
        #contenedorRese√±a {
            padding: 15px 3%; 
        }
        #rese√±aCliente {
            width: 96%; 
            min-height: 80px; 
            padding: 10px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            resize: vertical;
            background-color: #2c3a4a; /* Fondo oscuro del textarea */
            color: var(--color-text);
        }
        
        /* ************************************** */
        /* EFECTO DE ANIMACI√ìN COMPLEJA AL HACER CLIC */
        /* ************************************** */
        .clicked {
            transform: scale(1.05); 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
            opacity: 0.9; 
        }
        #btnEnviar.clicked {
            transform: scale(1.1); 
            background-color: var(--color-uis-green-hover);
        }
        .opcion-btn.clicked {
            transform: scale(1.03); 
            background-color: #556b82;
        }

    </style>
</head>
<body>
    
    <div id="contenedorCentrador">
        
        <div id="cuestionario">
            
            <div style="margin-bottom: 25px;">
                <img id="logo-uis-login" src="Universidad_Industrial_de_Santander_logo.svg.png" alt="Logo UIS" > 
                
                <h2 style="color: var(--color-uis-green); margin: 0; font-size: 1.8em;">Bienvenido al Asistente UIS</h2>
            </div>

            <p style="font-size: 1.1em;">Para acceder, por favor introduce tus datos:</p>
            
            <div id="alerta-inline" style="text-align: left;"></div>

            <input type="text" id="nombreUsuario" class="input-registro" placeholder="Escribe tu nombre aqu√≠" required>
            
            <input 
                type="tel" 
                id="correoUsuario" 
                class="input-registro" 
                placeholder="Escribe tu n√∫mero de tel√©fono (10 d√≠gitos)" 
                maxlength="10"
                pattern="[0-9]{10}"
                required
            >
            
            <div id="contenedorAutorizacion">
                <input type="checkbox" id="checkAutorizacion" required>
                <label for="checkAutorizacion">Autorizo el tratamiento de mis datos personales de acuerdo con la pol√≠tica de privacidad de la UIS.</label>
            </div>
            
            <button class="primary-btn" onclick="animateButton(this); iniciarMenu();" style="margin-top: 5px; width: 90%;">Iniciar Chat</button>
        </div>

        <div id="contenedorMenu" class="contenedor-principal" style="display: none;">
            
            <h2>
                <img id="logo-uis-header" src="Universidad_Industrial_de_Santander_logo.svg.png" alt="Logo UIS"> 
                Asistente de Informaci√≥n de la Universidad
                
                <div id="menuAccionesWrapperSuperior">
                    <button id="btnMenuAcciones" onclick="animateButton(this); toggleAccionesMenu()">
                        ‚ãÆ
                    </button>
                    
                    <div id="controlesSuperiores">
                        <button type="button" class="btn-accion-secundaria" onclick="mostrarRese√±aForm(); toggleAccionesMenu()">‚≠ê Dejar Rese√±a</button>
                        <button type="button" class="btn-accion-secundaria" onclick="descargarCSV(); toggleAccionesMenu()">üíæ Exportar CSV</button>
                        <button type="button" class="btn-accion-secundaria cerrar-sesion" onclick="volverAlInicio(); toggleAccionesMenu()">üö™ Cerrar Sesi√≥n</button>
                    </div>
                </div>
            </h2>
            
            <div id="historialChat">
                <div class="chat-bot" id="initial-greeting"></div>
            </div>

            <div id="opcionesFooter">
                
                <div id="opcionesMenu">
                    <button class="opcion-btn" onclick="animateButton(this); limpiarChat(false)">üßπ Limpiar Chat</button> 
                    <button class="opcion-btn" onclick="animateButton(this); procesarSeleccion('horario', this.textContent)">üïí Horario de Atenci√≥n</button>
                    <button class="opcion-btn" onclick="animateButton(this); procesarSeleccion('carreras_oferta', this.textContent)">üéì Oferta de Carreras</button>
                    <button class="opcion-btn" onclick="animateButton(this); procesarSeleccion('historia_creacion', this.textContent)">üìú Historia de Creaci√≥n</button>
                    <button class="opcion-btn" onclick="animateButton(this); procesarSeleccion('mision_vision', this.textContent)">üéØ Misi√≥n y Visi√≥n</button>
                    <button class="opcion-btn" onclick="animateButton(this); procesarSeleccion('ubicacion', this.textContent)">üìç Ubicaci√≥n (Sede)</button> 
                    <button class="opcion-btn" onclick="animateButton(this); procesarSeleccion('contacto', this.textContent)">üìû Contacto</button> 
                </div>

                <div id="inputChatContainer">
                    
                    <input type="text" id="inputMensaje" placeholder="Escribe tu pregunta aqu√≠..." onkeypress="return manejarEnter(event)">
                    <button id="btnEnviar" onclick="animateButton(this); enviarMensaje()">‚ñ∂</button>
                </div>
                
            </div>
            
            <div id="contenedorRese√±a" style="display: none; padding: 15px 3%; background-color: #1a2a3a;">
                <label for="rese√±aCliente" style="display: block; margin-bottom: 10px; color: var(--color-text-secondary);">‚úçÔ∏è Escribe tu rese√±a o comentario:</label>
                <textarea id="rese√±aCliente" placeholder="Nos ayuda a mejorar..."></textarea>
                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                    <button type="button" class="opcion-btn" onclick="animateButton(this); ocultarRese√±aForm()">Cancelar</button>
                    <button class="primary-btn" onclick="animateButton(this); guardarRese√±a()" style="margin-top: 0; width: 70%; background-color: var(--color-uis-green);">Enviar Rese√±a</button>
                </div>
            </div>

        </div>
        
    </div> 
    
    <script>

        // *************************************
        // ********** FUNCI√ìN DE ANIMACI√ìN Y UTILIDADES DE ESPACIO ***********
        // *************************************
        function animateButton(buttonElement) {
            buttonElement.classList.add('clicked');
            
            setTimeout(() => {
                buttonElement.classList.remove('clicked');
            }, 200); 
        }

        function toggleAccionesMenu() {
            const menu = document.getElementById('controlesSuperiores');
            menu.classList.toggle('active');
            
            // Si el men√∫ se cierra y la rese√±a estaba visible, la ocultamos
            if (!menu.classList.contains('active') && document.getElementById('contenedorRese√±a').style.display === 'block') {
                 ocultarRese√±aForm();
            }
        }
        
        // *************************************
        // ********** DICCIONARIO CONVERSACIONAL INTEGRADO (LIMPIO Y ENFOCADO EN UIS) ***********
        // *************************************
        const conversationalData = {
          "intents": {
            "saludo": [
              "¬°Hola! ¬øC√≥mo est√°s? Soy tu asistente virtual de la UIS.",
              "¬°Buen d√≠a! ¬øEn qu√© puedo ayudarte hoy con informaci√≥n de la universidad?",
              "Hola, soy tu asistente UIS. Estoy aqu√≠ para resolver tus dudas."
            ],
            // INTENCI√ìN DE ESTADO REFORZADA
            "como_estas": [ 
              "¬°Excelente! Soy un programa de software, as√≠ que siempre estoy listo para trabajar. ¬øY t√∫, c√≥mo te sientes hoy?",
              "Muy bien, gracias por preguntar. Listo para ayudarte con la informaci√≥n de la UIS. ¬øQu√© necesitas?",
              "Funcionando al 100%. Mi √∫nico trabajo es asistirte. ¬øTienes alguna pregunta sobre la universidad?"
            ],
            // INTENCI√ìN DE FUNCI√ìN
            "que_haces": [
              "Soy un chatbot dise√±ado para responder preguntas frecuentes sobre la Universidad Industrial de Santander, como su historia, oferta acad√©mica y contacto.",
              "Mi prop√≥sito es facilitarte informaci√≥n precisa y r√°pida sobre la UIS. Preg√∫ntame sobre horarios, carreras o ubicaci√≥n.",
              "Estoy procesando datos institucionales. ¬øEn qu√© informaci√≥n espec√≠fica de la UIS puedo enfocarme para ayudarte?"
            ],
            "despedida": [
              "¬°Hasta luego! Vuelve pronto a la p√°gina de la UIS.",
              "Que tengas un gran d√≠a. ¬°√âxitos en tus estudios!",
              "Adi√≥s, cualquier otra duda sobre la universidad, no dudes en preguntar."
            ],
            "horario": [
              "Nuestro horario de atenci√≥n administrativa es de **lunes a viernes de 8:00 a.m. a 6:00 p.m.**",
              "La universidad atiende en jornadas de 8 a 6, de lunes a viernes."
            ],
            "carreras_oferta": [
              "Ofrecemos **Ingenier√≠a, Medicina, Derecho** y muchos m√°s programas acad√©micos. ¬øBuscas un √°rea espec√≠fica?",
              "Nuestra oferta incluye programas de pregrado y posgrado. Puedes ver la lista completa en nuestra web oficial."
            ],
            "default": [
              "Lo siento, mi base de conocimientos solo cubre temas de la UIS. ¬øPodr√≠as reformular tu pregunta sobre **historia, carreras, o contacto**?",
              "No tengo informaci√≥n sobre ese tema. Por favor, enf√≥cate en preguntas sobre la universidad."
            ],
            "agradecimiento": [
              "¬°De nada! Siempre estoy aqu√≠ para ayudarte con informaci√≥n UIS. üòä",
              "Con gusto, me alegra mucho haberte servido. ¬°Vuelve pronto!"
            ],
            "ayuda": [
              "Claro, dime con qu√© necesitas ayuda. Estoy a tu disposici√≥n para preguntas sobre la UIS.",
              "Estoy aqu√≠ para asistirte. ¬øCu√°l es tu pregunta sobre la instituci√≥n?"
            ],
            "identidad": [
              "Soy un asistente virtual, un **chatbot desarrollado para la UIS**. ü§ñ",
              "Soy un bot dise√±ado para responder preguntas frecuentes sobre la Universidad Industrial de Santander."
            ],
            // *** RESPUESTAS AMPLIADAS ***
            "quien_eres_detallado": [
                "Fui creado por un grupo de **estudiantes de la UIS Saravena** como proyecto para mejorar la accesibilidad de la informaci√≥n institucional. Mi prop√≥sito es responder r√°pidamente tus preguntas sobre la historia, carreras y contacto de la Universidad Industrial de Santander. ¬°Estoy aqu√≠ para servirte!"
            ],
            "que_puedes_hacer": [
                "Puedo proporcionarte informaci√≥n detallada sobre la **Oferta Acad√©mica**, **Horarios de Atenci√≥n**, **Historia de Creaci√≥n**, **Ubicaci√≥n** y datos de **Contacto** de la UIS. Preg√∫ntame sobre estos temas usando texto o los comandos r√°pidos."
            ],
            "faq_general": [
                "Mis conocimientos se centran exclusivamente en la Universidad Industrial de Santander. Por favor, realiza tus preguntas sobre temas institucionales como **Admisiones, Carreras, Contacto, o Historia** para que pueda responderte mejor."
            ],
            // *************************
            "elogio_bot": [
              "Gracias, me esfuerzo por ser el mejor asistente de la UIS. üòÑ",
              "¬°Me alegra que pienses eso! Hago lo mejor que puedo con la informaci√≥n institucional. üí™"
            ],
            "contacto": [
              "Puedes contactarnos al correo **jecasmar@uis.edu.co** o al celular **+57 322 7565651**.",
              "La informaci√≥n de contacto es: Correo electr√≥nico jecasmar@uis.edu.co y celular +57 322 7565651."
            ],
            "ubicacion": [
              "Nuestra sede principal se encuentra en **Saravena, Arauca**.",
              "Estamos ubicados en la sede central de la ciudad. ¬°Ven a conocernos! üìç"
            ],
            "historia_creacion": [
              "La Universidad Industrial de Santander (UIS) fue creada por medio de la **Ordenanza 38 de 1944** de la Asamblea Departamental de Santander, aunque empez√≥ a funcionar oficialmente a√±os despu√©s, con el objetivo de impulsar el desarrollo t√©cnico e industrial de la regi√≥n."
            ],
             "historia_fundador": [
              "La UIS fue establecida durante la gobernaci√≥n de **Dr. Gustavo Rojas Pinilla**, quien promovi√≥ activamente su creaci√≥n y desarrollo en sus inicios."
            ],
            "mision_vision": [
              "La misi√≥n de la UIS es la **formaci√≥n integral de profesionales** y la generaci√≥n de **conocimiento cient√≠fico y tecnol√≥gico**. La visi√≥n es ser reconocida como una de las **mejores universidades del pa√≠s y de la regi√≥n** por su excelencia acad√©mica e impacto social."
            ]
          },
          "keywords": {
            "saludo": [
              "hola",
              "buenas",
              "saludos"
            ],
            // INTENCI√ìN DE ESTADO REFORZADA (m√°s espec√≠fica)
            "como_estas": [
              "c√≥mo est√°s",
              "como estas", // sin tilde para la b√∫squeda
              "como has estado",
              "que tal te va",
              "que tal",
              "c√≥mo te encuentras"
            ],
            // INTENCI√ìN DE FUNCI√ìN
            "que_haces": [
              "que haces",
              "a que te dedicas",
              "cual es tu trabajo",
              "que me puedes decir"
            ],
            "despedida": [
              "adi√≥s",
              "chao",
              "hasta luego",
              "me voy"
            ],
            "horario": [
              "horario",
              "hora",
              "abren",
              "cierran",
              "atenci√≥n"
            ],
            "carreras_oferta": [
              "carrera",
              "programa",
              "estudio",
              "que ofrecen",
              "oferta acad√©mica"
            ],
            "agradecimiento": [
              "gracias",
              "muchas gracias",
              "te lo agradezco"
            ],
            "ayuda": [
              "ayuda",
              "necesito ayuda",
              "soporte"
            ],
            "identidad": [
              "qui√©n eres",
              "como te llamas",
              "eres un bot",
              "tu nombre"
            ],
            // *** PALABRAS CLAVE AMPLIADAS ***
            "quien_eres_detallado": [
                "quien te creo",
                "cual es tu proposito",
                "eres un programa",
                "eres un chatbot"
            ],
            "que_puedes_hacer": [
                "que puedes hacer",
                "que sabes",
                "cuales son tus funciones",
                "como me ayudas"
            ],
            "faq_general": [
                "preguntas frecuentes",
                "faq",
                "otras preguntas",
                "sobre que sabes"
            ],
            // ******************************
            "elogio_bot": [
              "buen trabajo",
              "eres genial",
              "eres el mejor"
            ],
            "contacto": [
              "contacto",
              "tel√©fono",
              "llamar",
              "correo",
              "email",
              "n√∫mero"
            ],
            "ubicacion": [
              "ubicaci√≥n",
              "donde est√°n",
              "direcci√≥n",
              "sede",
              "lugar"
            ],
             "historia_creacion": [
              "cuando se cre√≥",
              "fundaci√≥n",
              "fecha de creaci√≥n",
              "origen uis",
              "ordenanza 38"
            ],
             "historia_fundador": [
              "quien la fund√≥",
              "fundador",
              "qui√©n cre√≥",
              "creador uis"
            ],
            "mision_vision": [
              "misi√≥n",
              "mision",
              "visi√≥n",
              "vision",
              "prop√≥sito",
              "objetivo de la uis"
            ]
          }
        };

        // *************************************
        // ********** MAPA DE DATOS DETALLADOS DE LA UIS (USADO POR LOS BOTONES) ************
        // *************************************
        const infoMap = {
            "horario": {
                titulo: "üïí Horario de Atenci√≥n UIS",
                cuerpo: "Nuestro horario es:<ul><li>**Lunes a Viernes:** 8:00 AM a 6:00 PM</li><li>**S√°bados:** 9:00 AM a 5:00 PM (Solo tr√°mites).</li></ul><p>Siempre estamos disponibles por correo electr√≥nico.</p>"
            },
            "carreras_oferta": {
                titulo: "üéì Oferta de Carreras UIS",
                cuerpo: "Ofrecemos:<ul><li>**Ingenier√≠a en Inteligencia Artificial**</li><li>**Zootecnia**</li><li>**Administraci√≥n Agropecuaria**</li></ul><p style='text-align: center;'><a href='https://uis.edu.co/es/' target='_blank'>**Ver todos los programas en UIS.edu.co**</a></p>"
            },
            "ubicacion": {
                titulo: "üìç Ubicaci√≥n de la Sede UIS",
                cuerpo: "<p>Nuestra sede principal se encuentra en **Saravena, Arauca**.</p><p style='text-align: center;'><a href='https://maps.google.com/?cid=17075253050066749818&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNl' target='_blank'>**Ver Ubicaci√≥n en Google Maps**</a></p>"
            },
            "contacto": {
                titulo: "üìû Contacto Directo UIS",
                cuerpo: "Puedes contactarnos al correo **jecasmar@uis.edu.co** o al celular **+57 322 7565651**.",
                // Correcci√≥n: El cuerpo debe estar correctamente formateado como una cadena
            },
            "historia_creacion": {
                titulo: "üìú Creaci√≥n de la UIS",
                cuerpo: "La UIS fue fundada por la **Ordenanza 38 de 1944**, impulsada por la necesidad de una educaci√≥n t√©cnica superior en la regi√≥n. Su visi√≥n ha sido siempre la de impulsar el desarrollo industrial y cient√≠fico."
            },
            "mision_vision": {
                titulo: "üéØ Misi√≥n y Visi√≥n UIS",
                cuerpo: "La **Misi√≥n** es la formaci√≥n integral de profesionales y la generaci√≥n de conocimiento. La **Visi√≥n** es ser referente de excelencia acad√©mica en el pa√≠s y la regi√≥n."
            }
        };

        // *************************************
        // ********** L√ìGICA CORE DEL CHATBOT ************
        // *************************************
        
        let ultimoUsuario = null; // Almacena {nombre, telefono, rese√±a} del usuario activo.
        // Inicializa el array para persistencia de datos (almacena todos los registros)
        const registrosUsuarios = JSON.parse(localStorage.getItem('registrosUsuarios')) || []; 
        const CODIGO_SECRETO = "admin123";

        function displayBotResponse(cuerpo, titulo, showOptions = true) {
            const historialChat = document.getElementById('historialChat');
            const botHtml = `
                <div class="chat-bot">
                    <h4>${titulo}</h4>
                    <p>${cuerpo}</p>
                    ${showOptions ? `
                    <div class="acciones-post-respuesta" style="margin-top: 10px; padding-top: 5px; border-top: 1px dashed #3f5166; text-align: right;">
                        <label style="font-size: 0.8em; font-weight: 400; color: var(--color-text-secondary); margin-right: 10px;">¬øAlgo m√°s en lo que te pueda ayudar?</label>
                        <button class="opcion-btn" onclick="animateButton(this); mostrarOpciones()" style="background-color: var(--color-uis-green); color: white; border: none;">Ver Opciones</button>
                    </div>
                    ` : ''}
                </div>
            `;
            historialChat.innerHTML += botHtml;
            historialChat.scrollTop = historialChat.scrollHeight;
        }

        function buscarRespuesta(mensaje) {
            const mensajeMinusculas = mensaje.toLowerCase().trim();
            
            for (const intent in conversationalData.keywords) {
                const keywords = conversationalData.keywords[intent];
                for (const keyword of keywords) {
                    if (mensajeMinusculas.includes(keyword)) {
                        
                        // Si la intenci√≥n tiene un mapa de informaci√≥n detallada (como los botones)
                        if (intent in infoMap) {
                            return { intent: intent, isDetailed: true };
                        }
                        
                        // Si la intenci√≥n tiene una respuesta simple en el diccionario
                        if (conversationalData.intents[intent]) {
                            const responses = conversationalData.intents[intent];
                            const responseText = responses[Math.floor(Math.random() * responses.length)];
                            return { intent: intent, response: responseText, isDetailed: false };
                        }
                    }
                }
            }

            const defaultResponses = conversationalData.intents.default;
            const defaultResponse = defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
            return { intent: "default", response: defaultResponse, isDetailed: false };
        }

        function enviarMensaje() {
            const inputElement = document.getElementById('inputMensaje');
            const mensaje = inputElement.value.trim();
            inputElement.value = ''; 
            
            if (mensaje === "") return; 

            const historialChat = document.getElementById('historialChat');
            const userHtml = `<div class="chat-user">${mensaje}</div>`;
            historialChat.innerHTML += userHtml;
            historialChat.scrollTop = historialChat.scrollHeight;
            
            const resultado = buscarRespuesta(mensaje);

            if (resultado.isDetailed) {
                procesarRespuestaBot(resultado.intent);
            } else {
                let titulo = "Asistente UIS";
                if (resultado.intent === "default") {
                    titulo = "ü§î No estoy seguro de esa pregunta...";
                } else if (resultado.intent === 'quien_eres_detallado' || resultado.intent === 'que_puedes_hacer' || resultado.intent === 'que_haces') {
                     titulo = "Informaci√≥n del Asistente"; 
                } else if (resultado.intent === 'como_estas' || resultado.intent === 'saludo') { 
                     titulo = "Saludos del Asistente";
                }
                const cuerpo = resultado.response.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                displayBotResponse(cuerpo, titulo, true);
            }
        }

        function procesarRespuestaBot(optionValue) {
            let titulo = "Asistente UIS";
            let cuerpo = "";
            let mostrarOpcionesBoton = true;
            
            if (optionValue in infoMap) {
                const info = infoMap[optionValue];
                titulo = info.titulo;
                cuerpo = info.cuerpo.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                mostrarOpcionesBoton = true;
            } else {
                 // Si la respuesta es de texto simple (incluye las nuevas FAQ y el estado)
                 if (optionValue in conversationalData.intents) {
                     titulo = (optionValue === 'faq_general' || optionValue === 'quien_eres_detallado' || optionValue === 'que_puedes_hacer' || optionValue === 'que_haces') ? "Informaci√≥n del Asistente" :
                              (optionValue === 'como_estas' || optionValue === 'saludo') ? "Saludos del Asistente" : "Informaci√≥n UIS";
                     const responses = conversationalData.intents[optionValue];
                     cuerpo = responses[Math.floor(Math.random() * responses.length)].replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                     mostrarOpcionesBoton = true;
                 } else {
                    const defaultResponses = conversationalData.intents.default;
                    titulo = "ü§î ¬°Vaya! Esa pregunta me super√≥...";
                    cuerpo = defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
                    mostrarOpcionesBoton = false;
                 }
            }

            displayBotResponse(cuerpo, titulo, mostrarOpcionesBoton);
        }

        function procesarSeleccion(optionValue, optionText) {
            
            const historialChat = document.getElementById('historialChat');

            const userHtml = `<div class="chat-user">${optionText}</div>`;
            historialChat.innerHTML += userHtml;
            historialChat.scrollTop = historialChat.scrollHeight;
            
            procesarRespuestaBot(optionValue);
        }

        // *************************************
        // ********** FUNCIONES DE INTERFAZ ************
        // *************************************

        function manejarEnter(event) {
            if (event.key === 'Enter') {
                document.getElementById('btnEnviar').click(); 
                return false; 
            }
            return true;
        }
        
        // FUNCI√ìN PARA ACTUALIZAR EL SALUDO INICIAL CON EL NOMBRE DEL USUARIO
        function actualizarSaludoInicial(nombre) {
            const initialGreeting = document.getElementById('initial-greeting');
            
            initialGreeting.innerHTML = `
                <h4>¬°Hola, ${nombre}! Soy tu Asistente UIS</h4>
                <p>¬°Me alegra saludarte! Soy el asistente virtual de la UIS y estoy aqu√≠ para resolver tus dudas. Puedes preguntar sobre la **historia**, **carreras**, o **contacto**.</p>
            `;
        }

        function iniciarMenu() {
            const nombre = document.getElementById('nombreUsuario').value.trim();
            const telefono = document.getElementById('correoUsuario').value.trim(); // <-- Tel√©fono
            const autorizado = document.getElementById('checkAutorizacion').checked;
            
            if (nombre === "") { 
                mostrarAlertaInline("‚ùå Por favor, introduce tu nombre."); 
                return;
            }
            
            // Validaci√≥n del tel√©fono (debe ser de 10 d√≠gitos)
            if (telefono === "" || !/^\d{10}$/.test(telefono)) {
                mostrarAlertaInline("‚ùå Por favor, introduce tu n√∫mero de tel√©fono (debe tener exactamente 10 d√≠gitos num√©ricos)."); 
                return;
            }
            
            if (!autorizado) {
                 mostrarAlertaInline("‚ùå Debes autorizar el tratamiento de datos para iniciar el chat."); 
                 return;
            }
            
            const nuevoRegistro = {
                nombre: nombre,
                telefono: telefono, 
                rese√±a: ""
            };

            registrosUsuarios.push(nuevoRegistro);
            localStorage.setItem('registrosUsuarios', JSON.stringify(registrosUsuarios));
            
            ultimoUsuario = nuevoRegistro; 
            
            document.getElementById('cuestionario').style.display = 'none';
            document.getElementById('contenedorMenu').style.display = 'flex'; 
            
            actualizarSaludoInicial(nombre); 
            
            document.getElementById('historialChat').scrollTop = document.getElementById('historialChat').scrollHeight;
        }

        function volverAlInicio() {
            document.getElementById('contenedorMenu').style.display = 'none';
            document.getElementById('cuestionario').style.display = 'block'; 
            limpiarChat(true); 
            ocultarRese√±aForm();
        }
        
        function limpiarChat(isFullReset = false) {
            const historialChat = document.getElementById('historialChat');
            
            if (isFullReset) {
                 historialChat.innerHTML = `<div class="chat-bot" id="initial-greeting"></div>`;
                 if (ultimoUsuario && ultimoUsuario.nombre) {
                    actualizarSaludoInicial(ultimoUsuario.nombre);
                 } else {
                     actualizarSaludoInicial("Invitado");
                 }
            } else {
                historialChat.innerHTML = document.getElementById('initial-greeting').outerHTML;
            }
            
            historialChat.scrollTop = historialChat.scrollHeight;
            
            // Ocultar el men√∫ de acciones si estaba abierto
            document.getElementById('controlesSuperiores').classList.remove('active');
        }
        
        function mostrarAlertaInline(mensaje, esError = true) {
            const alerta = document.getElementById('alerta-inline');
            if (document.getElementById('cuestionario').style.display !== 'none') {
                alerta.textContent = mensaje;
                alerta.style.display = 'block';
                alerta.style.backgroundColor = esError ? '#4a1e28' : '#2b4f34'; /* Colores oscuros para las alertas */
                alerta.style.color = esError ? '#ffaaaa' : '#b2ffb2'; 
            }
        }
        
        function mostrarOpciones() {
            const historialChat = document.getElementById('historialChat');
            
            const botHtml = `
                <div class="chat-bot">
                    <h4>Asistente UIS</h4>
                    <p>¬°Claro que s√≠! Mira las opciones de comando justo abajo. Siempre puedes escribir tu pregunta tambi√©n. üëá</p>
                </div>
            `;
            historialChat.innerHTML += botHtml;
            historialChat.scrollTop = historialChat.scrollHeight;
        }

        function mostrarRese√±aForm() {
            document.getElementById('opcionesFooter').style.display = 'none';
            document.getElementById('contenedorRese√±a').style.display = 'block';
        }
        
        function ocultarRese√±aForm() {
            document.getElementById('contenedorRese√±a').style.display = 'none';
            document.getElementById('opcionesFooter').style.display = 'flex';
            document.getElementById('rese√±aCliente').value = ''; 
        }

        function mostrarAlerta(mensaje) {
            // Reutilizamos el bot√≥n de enviar para mostrar alertas temporales en el footer
            const alertaBtn = document.getElementById('btnEnviar');
            const originalIcon = alertaBtn.innerHTML;
            const originalBg = alertaBtn.style.backgroundColor;

            alertaBtn.innerHTML = mensaje; // Muestra el mensaje en el bot√≥n de enviar temporalmente
            alertaBtn.style.width = 'auto';
            alertaBtn.style.height = 'auto';
            alertaBtn.style.borderRadius = '8px';
            alertaBtn.style.backgroundColor = '#4a1e28'; // Un color de alerta diferente

            setTimeout(() => {
                alertaBtn.innerHTML = originalIcon;
                alertaBtn.style.width = '40px';
                alertaBtn.style.height = '40px';
                alertaBtn.style.borderRadius = '50%';
                alertaBtn.style.backgroundColor = originalBg; 
            }, 5000);
        }

    function guardarRese√±a(event) {
    // üõë IMPORTANTE: Evita la recarga de la p√°gina si es llamada desde un formulario
    if (event && event.preventDefault) {
        event.preventDefault(); 
    }

    const rese√±a = document.getElementById('rese√±aCliente').value.trim();
    
    // Validaciones
    if (rese√±a === "") {
        mostrarAlerta("Tu rese√±a est√° vac√≠a. Por favor, escribe un comentario.");
        return;
    }
    
    if (rese√±a.length < 5) { // A√±adida una validaci√≥n de longitud m√≠nima
        mostrarAlerta("La rese√±a debe tener al menos 5 caracteres.");
        return;
    }

    if (typeof ultimoUsuario === 'undefined' || ultimoUsuario === null || !ultimoUsuario.nombre) { 
        mostrarAlerta("Error: Usuario no registrado. Vuelve a iniciar sesi√≥n."); 
        return; 
    }
    
    // 1. Limpia y asigna la rese√±a al objeto de sesi√≥n activo
    // Al usar CSV, es buena pr√°ctica limpiar caracteres problem√°ticos
    let rese√±aLimpia = rese√±a.replace(/,/g, ";").replace(/\n/g, " ");
    ultimoUsuario.rese√±a = rese√±aLimpia;
    
    // 2. Encuentra y actualiza el registro en el array persistente (localStorage)
    // Se usa el nombre y el tel√©fono para encontrar el registro
    const index = registrosUsuarios.findIndex(r => r.nombre === ultimoUsuario.nombre && r.telefono === ultimoUsuario.telefono);
    
    if (index !== -1) {
        registrosUsuarios[index].rese√±a = rese√±aLimpia;
        // 3. Guarda el array actualizado en localStorage
        localStorage.setItem('registrosUsuarios', JSON.stringify(registrosUsuarios));
    } else {
        // En un escenario real, si no lo encuentra, podr√≠a ser un usuario nuevo 
        // o un error de l√≥gica. Asumimos que se crea en iniciarMenu().
        mostrarAlerta("Error al guardar: Registro de usuario no encontrado en la lista global.");
        return;
    }

    // 4. Limpia la interfaz y notifica al usuario
    document.getElementById('rese√±aCliente').value = ''; // Limpia el textarea
    ocultarRese√±aForm();
    mostrarAlerta("‚úÖ ¬°Rese√±a enviada y guardada localmente! Gracias por tus comentarios."); 
    }

    // *************************************
    // ********** NUEVA FUNCI√ìN PARA EXPORTAR CSV ************
    // *************************************
    
    function descargarCSV() {
        // La variable global registrosUsuarios ya est√° cargada desde localStorage
        const data = JSON.parse(localStorage.getItem('registrosUsuarios')) || [];
        
        if (data.length === 0) {
            mostrarAlerta("No hay registros de usuarios para exportar.");
            return;
        }

        // Define los encabezados del CSV
        const headers = ["Nombre", "Tel√©fono", "Rese√±a"];
        
        // Mapea los datos a filas
        const rows = data.map(item => [
            item.nombre || '',
            item.telefono || '',
            // Se encierra la rese√±a entre comillas y se escapan las comillas internas (para manejar comas y saltos de l√≠nea)
            `"${(item.rese√±a || '').replace(/"/g, '""')}"` 
        ]);

        // Combina encabezados y filas
        // Se a√±ade el BOM (\ufeff) para asegurar que se abra bien en Excel con UTF-8
        const csvContent = [
            headers.join(","),
            ...rows.map(e => e.join(","))
        ].join("\n");

        // Crea un objeto Blob (archivo) y un enlace de descarga
        const blob = new Blob(["\ufeff", csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', 'registros_usuarios_uis.csv');
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        mostrarAlerta("‚úÖ Datos de usuarios exportados correctamente en CSV.");
    }
    </script>
    
</body>
</html>